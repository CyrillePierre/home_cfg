#!/bin/bash
backup_dir_model='/tmp/backup_home_XXXXXX'
backup_dir="$(mktemp -d "$backup_dir_model")"

install_with_backup() {
	path_dest="$HOME/$2"
	rsync -a --info=NAME --backup-dir="$backup_dir" "$1" "$path_dest"
}

install_nvim() {
	# sudo apt-get install -y python3-venv
	mkdir -p $HOME/.local/share/nvim/sessions
	install_with_backup nvim .config/
}

install_tmux() {
	install_with_backup tmux .config/

	TPM_DIR="${HOME}/.config/tmux/plugins/tpm"
	if test ! -d "${TPM_DIR}"; then
		git clone 'https://github.com/tmux-plugins/tpm' "${HOME}/.config/tmux/plugins/tpm"
		if test -z "${TMUX}"; then
			tmux new "${TPM_DIR}/bindings/install_plugins"
		else
			"${TPM_DIR}/bindings/install_plugins"
		fi
	fi
}

install_zoxide() {
  if ! which zoxide 2>&1 >/dev/null ; then
    curl -sS https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | bash
  fi
}

# cd to script directory
cd "$(dirname "${BASH_SOURCE[0]}")"

echo "backup dir: $backup_dir"
echo "updated files:"

mkdir -p $HOME/.vim/
install_with_backup vim/vimrc .vimrc
install_with_backup vim/ycm_extra_conf.py .vim/ycm_extra_conf.py.off
install_with_backup vim/colors .vim/
install_with_backup vim/after .vim/
#install_with_backup vim/syntax .vim/
install_with_backup vim/autoload .vim/
mkdir -p $HOME/.vim/swapfiles
mkdir -p $HOME/.vim/backup
mkdir -p $HOME/.vim/undodir
mkdir -p $HOME/.vim/sessions

install_with_backup zsh/zshrc .zshrc
install_with_backup zsh/zsh/ .zsh
install_with_backup zsh/cfyzshprompt/ .cfyzshprompt

mkdir -p $HOME/.config/htop/
mkdir -p $HOME/.config/clangd/
install_with_backup gdbinit .gdbinit
install_with_backup gitconfig .gitconfig
install_with_backup rofi/config.rasi .config/rofi/
install_with_backup htop/htoprc .config/htop/
install_with_backup terminator .config/
install_with_backup pycodestyle .config/
install_with_backup clang/clangd.yaml .config/clangd/config.yaml
install_with_backup clang/clang-format .clang-format
install_with_backup yapf .config/
install_with_backup fonts .local/share/

echo "other install..."
install_nvim
install_tmux
install_zoxide

# update fonts
fc-cache
